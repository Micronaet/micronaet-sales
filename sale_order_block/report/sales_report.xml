<?xml version="1.0" encoding="utf-8"?>
<openerp>
   <data>
        <!--Add custom CSS:-->
        <!--<template id="minimal_layout_css_inherit" inherit_id="web.report_assets_common">
            <xpath expr="link" position="before">
                <link rel='stylesheet' href="/sale_order_block/static/src/css/sale_report.css"/>
            </xpath>
        </template>-->
        <!--                         Report template:                                -->
        <template id="report_sale_block_lang">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <!-- HEADER: -->
                            <div class="row">
                                <div class="col-xs-2">
                                    <!--LOGO-->
                                    <div style="width: 100%;float: left;">
                                        <img src='/web/binary/company_logo' style="width: 100%"/>
                                    </div>
                                </div>
                                <div class="col-xs-4">
                                    <span t-field="res_company.partner_id.name" /><br/>
                                    P. IVA: <span t-field="res_company.partner_id.vat" />
                                </div>
                                <div class="col-xs-6">
                                </div>
                            </div>
                            <div class="oe_structure"/>
                            <hr />

                             <!-- DESTINATION BOX: -->
                            <div class="oe_structure"/>
                            <div class="row">
                                <div class="col-xs-5">
                                </div>
                                <div class="col-xs-7">
                                    <span class="company_address" t-field="o.partner_id"
                                       t-field-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": true}'/>
                                    <!--<div t-field="o.partner_id.name" />
                                    <div t-field="o.partner_id.street" /> - <div t-field="o.partner_id.zip" />
                                    <div t-field="o.partner_id.city" />
                                    Tel.: <div t-field="o.partner_id.phone" />
                                    Fax: <div t-field="o.partner_id.fax" />
                                    E-mail: <div t-field="o.partner_id.email" />
                                    Cod. Fiscale: <div t-field="o.partner_id.fiscalcode" />
                                    P. IVA: <div t-field="o.partner_id.vat" />-->
                                </div>
                            </div>

                            <div class="oe_structure"/>
                            <div class="row">
                                <div class="col-xs-6">
                                    <div>
                                        <span t-esc="'PREVENTIVO' if o.state in ['draft','sent'] else 'ORDINE'"/>
                                        <span t-esc="o.name"/>
                                    </div>
                                    Referente: <div t-esc="'' and 'o.client_order_ref or '" />
                                </div>
                                <div class="col-xs-6">
                                    <div t-esc="o.date_order or ''" />
                                </div>
                            </div>

                            <!--                          DETAIL:                         -->
                            <!-- BLOCK LOOP: -->
                            <t t-foreach="o.block_ids" t-as="block">
                                <t t-if="show_the_block(block, data)">
                                    <t t-if="block.show_header">
                                        <h3 t-esc="block.name.upper()" />
                                    </t>
                                    <div t-esc="block.pre_text or ''"/>

                                    <table>
                                        <thead>
                                            <tr class="row"><th>DETTAGLIO</th><th>Q.</th><th>PREZZO</th><th>SCONTO</th><th>TOTALE</th></tr>
                                        </thead>
                                        <tbody>
                                            <row>
                                            <tr class="row"><td>DETTAGLIO</td><td>Q.</td><td>PREZZO</td><td>SCONTO</td><td>TOTALE</td></tr>
                                            </row>
                                        </tbody>
                                    </table>
                                    <!--<t t-if="block.show_price">
                                    </t>-->
                                    <t t-if="block.show_detail">
                                        <!-- Detail header -->
                                        <div class="oe_structure"/>
                                        <div class="row">
                                            <div class="col-xs-4">
                                                <b>DETTAGLIO</b>
                                            </div>
                                            <div class="col-xs-2">
                                                <b>Q.</b>
                                            </div>
                                            <div class="col-xs-2">
                                                <b>PREZZO</b>
                                            </div>
                                            <div class="col-xs-2">
                                                <b>SCONTO</b>
                                            </div>
                                            <div class="col-xs-2">
                                                <b>TOTALE</b>
                                            </div>
                                        </div>

                                        <!-- Detail data -->
                                        <div class="oe_structure"/>
                                        <t t-foreach="block.line_ids" t-as="l">
                                            <!--<div class="oe_structure"/>-->
                                            <div class="row">
                                                <div class="col-xs-4">
                                                    <span t-esc="clean_name(l)"/>
                                                </div>
                                                <div class="col-xs-2">
                                                    <span t-esc="l.product_uom_qty"/>
                                                    <span t-esc="(l.product_uom and l.product_uom.name) or ''"/>
                                                </div>
                                                <div class="col-xs-2">
                                                    <span t-esc="l.price_unit"/>
                                                    <!--TODO format currency and symbol-->
                                                </div>
                                                <div class="col-xs-2">
                                                    <span t-esc="l.discount"/>
                                                </div>
                                                <div class="col-xs-2">
                                                    <span t-esc="l.price_subtotal" />
                                                    <!--<t t-esc="tax_data['amount']" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>-->
                                                </div>
                                            </div>
                                        </t>

                                        <t t-if="block.show_total">
                                            <div class="oe_structure"/>
                                            <div class="row">
                                                <div class="col-xs-3">
                                                    <span t-esc="'TOTALE A CORPO' if block.total else 'TOTALE A SEZIONE'"/>
                                                </div>
                                                <div class="col-xs-3">
                                                    <span t-esc="block.total or block.real_total"/>
                                                </div>
                                            </div>
                                        </t>

                                        <div t-esc="block.post_text or ''"/>
                                    </t>
                                </t>
                            </t>
                            <!--Master total:-->
                            <t t-if="o.show_master_total">
                                <div class="oe_structure"/>
                                <div class="row">
                                    <div class="col-xs-3">
                                        TOTALE OFFERTA
                                    </div>
                                    <div class="col-xs-3">
                                        <span t-esc="o.real_total"/>
                                    </div>
                                </div>
                            </t>

                            <!-- END OF PAGE: -->
                            <br />
                            <div class="oe_structure"/>
                            <div class="row">
                                <div class="col-xs-1">
                                </div>
                                <div class="col-xs-11" >
                                    <b>N.B.:</b> I prezzi si intendono esclusi di IVA (ove applicata).<br/>
                                    TERMINI DI PAGAMENTO:
                                    <span t-esc="(o.payment_term_id and o.payment_term_id.name) or ''"/>
                                </div>
                            </div>

                        </div>
                    </t>
                </t>
            </t>
        </template>
        <!--<template id="report_sale_block_lang_temp">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="sale_order_block.report_sale_block" t-lang="doc.partner_id.lang"/>
                </t>
            </t>
        </template>-->

        <record id="paperformat_accounting" model="report.paperformat">
            <field name="name">Sale report</field>
            <field name="default" eval="True"/>
            <field name="format">custom</field>
            <field name="page_height">297</field>
            <field name="page_width">210</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">10</field>
            <field name="margin_bottom">5</field>
            <field name="margin_left">5</field>
            <field name="margin_right">5</field>
            <field name="header_line" eval="True"/>
            <field name="header_spacing">3</field>
            <field name="dpi">90</field>
        </record>

        <!--Report action:-->
        <report
            id="action_report_sale_block_lang"
            model="sale.order"
            string="Sale Block report"
            report_type="qweb-pdf"
            name="sale_order_block.report_sale_block_lang"
            file="sale_order_block.report_sale_block_lang"
            attachment_use="True"
            attachment="'%s.%s' % ((object.name or 'draft').replace('/', '_'), object.printed)"
            print_report_name="'%s.%s' % ((object.name or 'draft').replace('/', '_'), object.printed)"
            paperformat="paperformat_accounting"
        />

   </data>
</openerp>
